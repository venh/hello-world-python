pipeline 
{
    agent 
    {
      node
       {        
         label "slave01"
       }
    }
     environment {
	   BLD_STATUS = '$BUILD_STATUS'
	   PRJ_NAME = '$PROJECT_NAME'
     }// end of environment
    options 
    { 
      skipDefaultCheckout() 
      disableConcurrentBuilds()
    }    
    stages {		
        stage('Checkout Source') {
            steps {
                    cleanWs()
                    echo ":: git checkout source"
                    checkout([
                               $class: 'GitSCM',
                               branches: [[name: "*/main"]],
                               doGenerateSubmoduleConfigurations: false,
                               extensions: [
                                   [$class: 'RelativeTargetDirectory', relativeTargetDir: '.']
                               ],                    
                               submoduleCfg: [],
                               userRemoteConfigs: 
                               [
                                  [
                                     url: "https://github.com/venh/hello-world-python.git"
                                  ]
                               ]
                      ])                
                  }
	} // end of Checkout Stage
		
        stage('Building & Running Container') {
            steps {
		     echo "Build Docker Image and Run the Container"
		     script{ 
				sh """
					docker rmi -f py-img
					docker build -t py-img .
					docker rm -f py-container
					docker run --name py-container py-img
				 """
		      }
              } // end of Steps
        } // end of Build stage	
    } // end of Stages
    post{
        always {
            sendEmail('$DEFAULT_RECIPIENTS', null, "[${env.BLD_STATUS}] - ${env.PRJ_NAME} - Build # ${BUILD_NUMBER} ($BUILD_ID)", '''${SCRIPT, template="custom-html.template"}''') 
	}
    } // end of post
} // end of Pipeline
